<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>ELF を吐く C コンパイラを Rui 本の方式で作る</title>
	<meta name="viewport" content="width=device-width">
<style>
		img.icon {
			border-radius: 50%;
		}
		div.one_person {
			display: flex;
			padding-bottom: 10px;
		}
		blockquote {
			position: relative;
			border-left: 3px solid #005242;
			padding-left: 10px;
			margin-inline-start: 10px;
			white-space: pre-wrap;
		}
		a {
			overflow-wrap: anywhere;
		}
		h3 {
			margin-top: 15px;
		}
		.name a {
			text-decoration: none;
			color: inherit;
		}
		.name a:hover {
			text-decoration: underline;
		}
		div.name_and_content {
			padding-left: 10px;
		}
		pre {
			white-space: pre-wrap;
		}
		body {
			text-size-adjust: 100%;
			-webkit-text-size-adjust: 100%;
		}
		.permalink {
			margin-left: 15px;
			padding: .2em .6em .3em;
			font-size: 75%;
			font-weight: 700;
			line-height: 1;
			color: #fff;
			text-align: center;
			white-space: nowrap;
			vertical-align: center;
			border-radius: .25em;
			background-color: #666666;
			text-decoration: none;
			visibility: hidden;
		}
	</style>
	<link rel="stylesheet" href="vs.min.css">
	<script src="highlight.min.js"></script>
	<script>hljs.highlightAll();</script>
</head>
<body style="background-color: #eeeeee">
<h1>ELF を吐く C コンパイラを Rui 本の方式で作る</h1>
<p>編纂者：<a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></p>
<p><a href="https://github.com/sozysozbot/c_to_elf_compiler">リポジトリへのリンク</a></p>
<p><a href="https://hsjoihs.hatenablog.com/entry/*****">はてなブログへのバックリンク (FIXME)</a></p>

<h2>会話ログ本体</h2><h3 class="date">2022年10月3日（Discord にて）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_95d88f0ac94e8d1025e3d1eec271a1bb').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_95d88f0ac94e8d1025e3d1eec271a1bb').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_95d88f0ac94e8d1025e3d1eec271a1bb" href="#permalink_95d88f0ac94e8d1025e3d1eec271a1bb" class="permalink">¶</a>
		<div class="content">そういや C コンパイラやってないな。アセンブリ言語を機械語にするのに binutils のを使うのもどうなんだろと思ってたらそのまま数ヶ月経ってた</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_3f2a03d776d134865ea86738cf71dd63').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_3f2a03d776d134865ea86738cf71dd63').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_3f2a03d776d134865ea86738cf71dd63" href="#permalink_3f2a03d776d134865ea86738cf71dd63" class="permalink">¶</a>
		<div class="content">いいですね。だったら、Rui 本の原則に則って、『step 1 からもう ELF バイナリへとコンパイルしちゃう』『常に実行形式をコンパイラが生成し続けられるようにする』というのでやってみませんか？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1ff958f9377fd22e8367451f0a272399').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1ff958f9377fd22e8367451f0a272399').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_1ff958f9377fd22e8367451f0a272399" href="#permalink_1ff958f9377fd22e8367451f0a272399" class="permalink">¶</a>
		<div class="content">なるほど</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_671c245347ecd6731eaf4f9ba276e82f').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_671c245347ecd6731eaf4f9ba276e82f').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_671c245347ecd6731eaf4f9ba276e82f" href="#permalink_671c245347ecd6731eaf4f9ba276e82f" class="permalink">¶</a>
		<div class="content">C → アセンブラのコンパイラをセルフホストしたあとにアセンブラとリンカと libc と書くのは既に ushitora_anqou がやってるけど、最初から ELF バイナリへとコンパイルしつづける形式で Rui 本を走ってる人を私は知らないので、やってみるとおもしろそう</div>
		<div class="content">教材書けとは言わんので、作業ログでもいいんで書いてみません？言語はどれでやるんです？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_770da497666650cc1b0b2648b7612410').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_770da497666650cc1b0b2648b7612410').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_770da497666650cc1b0b2648b7612410" href="#permalink_770da497666650cc1b0b2648b7612410" class="permalink">¶</a>
		<div class="content">もちろん Rust</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_cc97c50cfe1e67a2658c96151f6e1d2d').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_cc97c50cfe1e67a2658c96151f6e1d2d').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_cc97c50cfe1e67a2658c96151f6e1d2d" href="#permalink_cc97c50cfe1e67a2658c96151f6e1d2d" class="permalink">¶</a>
		<div class="content">じゃあ、step 1 は『return 3; するやつと return 42; するやつを gcc でコンパイルして ELF バイナリを吐いて、その差分を比較してどのバイトを置き換えるべきかを調べ、それを &#x60;include_bytes!()&#x60; する』という方針にするのがよさそう</div>
		<div class="content">なので、step 1 ではアセンブラもリンカもない。まあ、拡張していくと、機械語を直にいじるのがじきにきつくなるので、だんだんアセンブリ言語が育っていって、それは GNU のアセンブリ言語とそれなりに互換性があることが期待されるが、別にそれを目標にするわけではない。</div>
		<div class="content">という感じでやっていくとよさそう。今日はもう寝ます？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_2549241bf7ae5f463ba351590415956b').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_2549241bf7ae5f463ba351590415956b').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_2549241bf7ae5f463ba351590415956b" href="#permalink_2549241bf7ae5f463ba351590415956b" class="permalink">¶</a>
		<div class="content">いま布団の中です</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_bef481b97aada825069536205dcb453f').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_bef481b97aada825069536205dcb453f').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_bef481b97aada825069536205dcb453f" href="#permalink_bef481b97aada825069536205dcb453f" class="permalink">¶</a>
		<div class="content">ではでは、おやすみなさい〜</div>
	</div>
</div>
<h3 class="date">2022年10月3日（一人で作業）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_8e86cb6e213cb27b3a5ab911be5549a5').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_8e86cb6e213cb27b3a5ab911be5549a5').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_8e86cb6e213cb27b3a5ab911be5549a5" href="#permalink_8e86cb6e213cb27b3a5ab911be5549a5" class="permalink">¶</a>
		<div class="content">じゃあ私が勝手に step 1 を実装するか。なんなら会話ログももうレンダリングできるようにしておこう</div>
		<div class="content">とりあえず docs フォルダを立てて、docs/dialog.txt に会話を書いて docs/ 内で node index.js したらログがレンダリングできるようにしておいた</div>
		<div class="content">このリポジトリに招待を飛ばしておいて、</div>
		<div class="content">Ubuntu の方にリポジトリをクローンし、cargo init し、議事録を書く。おや、npm が通らない。えっと <a href="https://stackoverflow.com/questions/67938486/after-installing-npm-on-wsl-ubuntu-20-04-i-get-the-message-usr-bin-env-bash" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/67938486/after-installing-npm-on-wsl-ubuntu-20-04-i-get-the-message-usr-bin-env-bash</a> に従ったら直った。</div>
		<div class="content">ちゃんと README.md も書いておこう。まあ日本語と英語で書いておくか。</div>
		<div class="content">もう step 1 は私がやってしまおう。experiment フォルダにファイルを用意して、</div>
		<div class="content">とりあえず Makefile はこんな感じでいいか</div>
		<pre><code class="language-Makefile">CFLAGS=-std=c17 -Wall -s

3: 3.c
42: 42.c

clean: 
	rm 3
	rm 42

.PHONY: clean
</code></pre>
		<div class="content">gcc が出力したファイルのサイズを数えると、</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ wc -c 3
13296 3
</code></pre>
		<div class="content">うーむ、デカい！</div>
		<div class="content">まあ、考えてみると、一応 gcc の出力をそのまま使う必要もないんだよな</div>
		<div class="content"> <a href="https://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank" rel="noopener noreferrer">https://www.muppetlabs.com/~breadbox/software/tiny/teensy.html</a> に頼って、もっと小さい実行形式を出力できるようなお膳立てをしてからじゃないと step 1 にふさわしくない気がする</div>
		<div class="content">というか、reproducible なビルドになるようにしないといけないんだよな</div>
		<div class="content">……よし、こうするか。</div>
		<div class="content"><ol><li>nasm かなんかで小さな .asm をコンパイルすることで、我々が目指すべき「動く小さい ELF バイナリ」を得る</li><li>それはそれとして、我々が作るのは C コンパイラなので、常に C 言語（のようなもの）を入力として取る</li></ol></div>
	</div>
</div>
<h3 class="date">2022年10月3日（yukata_yu との会話）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/yukata_yu" target="_blank" rel="noopener noreferrer"><img alt="ゆかたゆ" class="icon" src="icons/ゆかたゆ.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_049f6dcd21896d3f1dc0920038a74215').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_049f6dcd21896d3f1dc0920038a74215').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/yukata_yu" target="_blank" rel="noopener noreferrer">ゆかたゆ</a></span><a id="permalink_049f6dcd21896d3f1dc0920038a74215" href="#permalink_049f6dcd21896d3f1dc0920038a74215" class="permalink">¶</a>
		<div class="content">-O1 を使わないのですか？ (エイリアスなんでしたっけ)</div>
		<div class="content">あー， -Osがあるんだ…</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_8ea4f902ea0033bc92d29429e5baa815').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_8ea4f902ea0033bc92d29429e5baa815').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_8ea4f902ea0033bc92d29429e5baa815" href="#permalink_8ea4f902ea0033bc92d29429e5baa815" class="permalink">¶</a>
		<div class="content">-O1 を導入せず、gcc を消し飛ばして nasm で作るようにします</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/yukata_yu" target="_blank" rel="noopener noreferrer"><img alt="ゆかたゆ" class="icon" src="icons/ゆかたゆ.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_e98a8badb501679c38398e0088e8b483').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_e98a8badb501679c38398e0088e8b483').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/yukata_yu" target="_blank" rel="noopener noreferrer">ゆかたゆ</a></span><a id="permalink_e98a8badb501679c38398e0088e8b483" href="#permalink_e98a8badb501679c38398e0088e8b483" class="permalink">¶</a>
		<div class="content">なるほ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_92f7f54b86e83f024726da054ab0a5db').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_92f7f54b86e83f024726da054ab0a5db').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_92f7f54b86e83f024726da054ab0a5db" href="#permalink_92f7f54b86e83f024726da054ab0a5db" class="permalink">¶</a>
		<div class="content">-Os を使うと、3 + 4 - 2 とかが畳み込まれちゃう気がするので</div>
		<div class="content">まあ一応 -Os でどれくらい減るのかも実験しておくか。そもそも nasm にする予定だけど。CFLAGS=-std=c17 -Wall -s -Os で試すと、</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ make 3
cc -std=c17 -Wall -s -Os    3.c   -o 3
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ make 42
cc -std=c17 -Wall -s -Os    42.c   -o 42
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ wc -c 3
14328 3
</code></pre>
		<div class="content">はい、ということで nasm 使います</div>
	</div>
</div>
<h3 class="date">2022年10月3日（一人で作業）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_7bd3a87583996ba4a89e989af9ee14d7').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_7bd3a87583996ba4a89e989af9ee14d7').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_7bd3a87583996ba4a89e989af9ee14d7" href="#permalink_7bd3a87583996ba4a89e989af9ee14d7" class="permalink">¶</a>
		<div class="content">とりあえず、原典にこうあるけど、</div>
		<pre><code class="language-x86asm">  ; tiny.asm
  BITS 32
  GLOBAL _start
  SECTION .text
  _start:
                mov     eax, 1
                mov     ebx, 42  
                int     0x80
</code></pre>
		<div class="content">64 ビット環境だし、この BITS 32 を削って実行してみるか。Makefile はこんな感じ</div>
		<pre><code class="language-Makefile">tiny42: tiny42.asm
	nasm -f elf tiny42.asm
	gcc -Wall -s -nostdlib tiny42.o -o tiny42
</code></pre>
		<div class="content">make tiny42 をすると～？</div>
		<pre><code class="language-shell">nasm -f elf tiny42.asm
gcc -Wall -s -nostdlib tiny42.o -o tiny42
/usr/bin/ld: i386 architecture of input file &#x60;tiny42.o&#x27; is incompatible with i386:x86-64 output
collect2: error: ld returned 1 exit status
make: *** [Makefile:12: tiny42] Error 1
</code></pre>
		<div class="content">はい。正直そんな気はしてた</div>
		<div class="content">普通に gcc 付属のアセンブラを使ってみるか</div>
		<pre><code class="language-x86asm">.globl _start
_start:
	movl	$1, %eax
	movl	$42, %ebx  
	int		$0x80
</code></pre>
		<div class="content">に対して</div>
		<pre><code class="language-Makefile">tiny42: tiny42.s
	gcc -Wall -s -nostdlib tiny42.s -o tiny42
</code></pre>
		<div class="content">をかませてやると、まあちゃんと動く。しかし wc -c tiny42 すると 13024 tiny42 なので、結局問題が解決してないんだよな</div>
		<div class="content">食事から戻った。やっていき</div>
		<div class="content"><a href="https://cs.lmu.edu/~ray/notes/nasmtutorial/" target="_blank" rel="noopener noreferrer">https://cs.lmu.edu/~ray/notes/nasmtutorial/</a> 曰く、</div>
		<pre><code class="language-">nasm -felf64 hello.asm &amp;&amp; ld hello.o &amp;&amp; ./a.out
</code></pre>
		<div class="content">でよいとのこと。なるほど、やってみるか</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ make tiny42
nasm -felf64 tiny42.asm
ld tiny42.o -o tiny42
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ ./tiny42
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ echo $?
42
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ wc -c tiny42
4672 tiny42
</code></pre>
		<div class="content">まあこんなもんか。これ以上削るのはやりすぎな気もする</div>
		<div class="content">一応マニュアル <a href="https://www.nasm.us/doc/" target="_blank" rel="noopener noreferrer">https://www.nasm.us/doc/</a> を見る。あ、--reproducible があるのか、都合がいい、つけておこう</div>
		<div class="content">おや、動かない。このバージョンの nasm にはないのかな</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ nasm --version
NASM version 2.14.02
</code></pre>
		<div class="content">マニュアルは version 2.15.05 となっている。この --reproducible、なんと version 2.15.05 で加わった最新の機能だそうだ。すばらしい</div>
		<div class="content">手元の WSL 2 上の Ubuntu でも sudo apt-get update からの sudo apt-get -y install nasm をすれば nasm が最新になってくれたりしないかな</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ sudo apt-get -y install nasm
Reading package lists... Done
Building dependency tree       
Reading state information... Done
nasm is already the newest version (2.14.02-1).
The following package was automatically installed and is no longer required:
  libfwupdplugin1
Use &#x27;sudo apt autoremove&#x27; to remove it.
0 upgraded, 0 newly installed, 0 to remove and 44 not upgraded.
</code></pre>
		<div class="content">残念。じゃあ自分で入れるしかないか</div>
		<div class="content">とりあえず <a href="https://www.linuxfromscratch.org/blfs/view/svn/general/nasm.html" target="_blank" rel="noopener noreferrer">https://www.linuxfromscratch.org/blfs/view/svn/general/nasm.html</a> に従って入れて……</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ nasm --version
NASM version 2.15.05 compiled on Oct  3 2022
</code></pre>
		<div class="content">よし。ではいよいよ</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ make tiny42
nasm -felf64  --reproducible tiny42.asm
ld tiny42.o -o tiny42
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ make tiny3
nasm -felf64  --reproducible tiny3.asm
ld tiny3.o -o tiny3
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ ./tiny42; echo $?
42
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ ./tiny3; echo $?
3
</code></pre>
		<div class="content">これは、やったか？</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ cmp -l ./tiny42 ./tiny3
4103  52   3
4185  21  20
4209  14  13
4233  30  27
4257  37  36
4286  64  63
4287  62  56
4288  56 141
4289 141 163
4290 163 155
4291 155   0
4292   0 137
4294 137 142
4295 142 163
4297 163 137
4298 137 163
4299 163 164
4300 164 141
4301 141 162
4302 162 164
4303 164   0
4304   0 137
4305 137 145
4306 145 144
4307 144 141
4308 141 164
4309 164 141
4310 141   0
4311   0 137
4312 137 145
4313 145 156
4314 156 144
4315 144   0
4317   0  56
4318  56 163
4319 163 171
4320 171 155
4321 155 164
4322 164 141
4323 141 142
4324 142   0
4325   0  56
4326  56 163
4327 163 164
4328 164 162
4329 162 164
4330 164 141
4331 141 142
4332 142   0
4333   0  56
4334  56 163
4335 163 150
4336 150 163
4337 163 164
4338 164 162
4339 162 164
4340 164 141
4341 141 142
4342 142   0
4343   0  56
4344  56 164
4345 164 145
4346 145 170
4347 170 164
4348 164   0
4577  44  43
4633 334 333
</code></pre>
		<div class="content">んー。ああそうか、ld 側にも reproducible にしてくれと頼まないと</div>
		<div class="content">……軽く調べたが、頼み方がよくわからん。リンカを gold にしたらバージョン名を埋め込んできたし。んー、1 バイトのズレはファイル名『tiny3.asm』『tiny42.asm』の差に起因してるっぽいし、そこを strip かなんかで処理すれば解決するかも？</div>
		<pre><code class="language-shell">hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ make tiny42
nasm -felf64  --reproducible tiny42.asm
ld tiny42.o -o tiny42
strip tiny42
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ make tiny3
nasm -felf64  --reproducible tiny3.asm
ld tiny3.o -o tiny3
strip tiny3
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ ./tiny42; echo $?; ./tiny3; echo $?
42
3
hsjoihs@LAPTOP-BKHPSENK:~/c_to_elf_compiler/experiment$ cmp -l ./tiny42 ./tiny3
4103  52   3
</code></pre>
		<div class="content">よし、差分が 1 バイトになった！！！！！</div>
		<div class="content">ここで 52 って出てるのは cmp コマンドがバイトを 8 進数で出力する仕様になっているからであって、これは 10 進数だと 42 なのでこれで正解です</div>
		<div class="content">よーし、やっとスタート地点に立つことができた</div>
		<pre><code class="language-rust">fn main() -&gt; std::io::Result&lt;()&gt; {
    let input = std::env::args().nth(1).expect(&quot;入力が与えられていません&quot;);
    let input: u8 = input.parse().expect(&quot;入力をパースできません&quot;);
    let tiny_3 = include_bytes!(&quot;../experiment/tiny3&quot;);
    let tiny_42 = include_bytes!(&quot;../experiment/tiny42&quot;);
    assert_eq!(tiny_3.len(), tiny_42.len());

    let file = std::fs::File::create(&quot;a.out&quot;)?;

    {
        use std::io::Write;
        let mut writer = std::io::BufWriter::new(file);
        for (index, byte) in tiny_3.iter().enumerate() {
            if *byte == tiny_42[index] {
                writer.write_all(&amp;[*byte])?;
            } else if *byte == 3 &amp;&amp; tiny_42[index] == 42 {
                writer.write_all(&amp;[input])?;
            } else {
                panic!(&quot;&#x60;../experiment/tiny3&#x60; と &#x60;../experiment/tiny42&#x60; の間に非自明な差分が見つかったので、なにを出力すべきか分かりません&quot;)
            }
        }
    }
    Ok(())
}
</code></pre>
		<div class="content">これで、step 1 達成！</div>
	</div>
</div>
<h3 class="date">2022年10月15日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_776345dcf24b83983b634024dc21ee83').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_776345dcf24b83983b634024dc21ee83').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_776345dcf24b83983b634024dc21ee83" href="#permalink_776345dcf24b83983b634024dc21ee83" class="permalink">¶</a>
		<div class="content">そういえば、あの実行形式まで作る c-to-elf-compiler</div>
		<div class="content">あれステップの偶奇で交互にやりません？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_3edcb1c9d03799deaded0284c0037468').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_3edcb1c9d03799deaded0284c0037468').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_3edcb1c9d03799deaded0284c0037468" href="#permalink_3edcb1c9d03799deaded0284c0037468" class="permalink">¶</a>
		<div class="content">あそこから先ってどうやるつもりなんです？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_a5e38cf1f66271d8f6a94d174487b79a').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_a5e38cf1f66271d8f6a94d174487b79a').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_a5e38cf1f66271d8f6a94d174487b79a" href="#permalink_a5e38cf1f66271d8f6a94d174487b79a" class="permalink">¶</a>
		<div class="content">いまは写経させてるわけですけど、ステップが進むごとに、その写経してる実行ファイルの内容を少しずつ学ばないといけない</div>
		<div class="content">逆に、学ばなくていいところは未来に先送りする</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_b08f0e4aa2dd086ecc5d5628c2c15808').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_b08f0e4aa2dd086ecc5d5628c2c15808').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_b08f0e4aa2dd086ecc5d5628c2c15808" href="#permalink_b08f0e4aa2dd086ecc5d5628c2c15808" class="permalink">¶</a>
		<div class="content">そこらへんの仕様って……ネットで調べれば落ちてるか</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_6a99f7d55f0c0423d2afa70274c2b030').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_6a99f7d55f0c0423d2afa70274c2b030').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_6a99f7d55f0c0423d2afa70274c2b030" href="#permalink_6a99f7d55f0c0423d2afa70274c2b030" class="permalink">¶</a>
		<div class="content">それを調べてログに書くのもステップの一部とする、という方針で考えてます</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/yuchiki1000yen" target="_blank" rel="noopener noreferrer"><img alt="yuchiki" class="icon" src="icons/yuchiki.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_6e6d11cc98d6a8933b9e0ee02d205b47').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_6e6d11cc98d6a8933b9e0ee02d205b47').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/yuchiki1000yen" target="_blank" rel="noopener noreferrer">yuchiki</a></span><a id="permalink_6e6d11cc98d6a8933b9e0ee02d205b47" href="#permalink_6e6d11cc98d6a8933b9e0ee02d205b47" class="permalink">¶</a>
		<div class="content">教育的授業だ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_bf486d7b2a2c1a5ef6ec2dbe4a18b619').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_bf486d7b2a2c1a5ef6ec2dbe4a18b619').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_bf486d7b2a2c1a5ef6ec2dbe4a18b619" href="#permalink_bf486d7b2a2c1a5ef6ec2dbe4a18b619" class="permalink">¶</a>
		<div class="content">自分でバイナリを吐き出したい、と</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_d2c1d15a6d8e11663fde07e6cb842be5').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_d2c1d15a6d8e11663fde07e6cb842be5').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_d2c1d15a6d8e11663fde07e6cb842be5" href="#permalink_d2c1d15a6d8e11663fde07e6cb842be5" class="permalink">¶</a>
		<div class="content">つまり、要は作る側が頑張らないことで、読む側も頑張らなくて済む。少しずつ、ELF の中身を謎解きしていく追体験ができる</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_975190c17473c286ddf30539ac76566b').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_975190c17473c286ddf30539ac76566b').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_975190c17473c286ddf30539ac76566b" href="#permalink_975190c17473c286ddf30539ac76566b" class="permalink">¶</a>
		<div class="content">まあたしかにたしかに</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_a46ab2cc04f56602aceac18ab5c9f06d').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_a46ab2cc04f56602aceac18ab5c9f06d').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_a46ab2cc04f56602aceac18ab5c9f06d" href="#permalink_a46ab2cc04f56602aceac18ab5c9f06d" class="permalink">¶</a>
		<div class="content">というのを考えています。ということで、ステップ 2 『足し算と引き算』やってみません？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_9d026e2f629913f144b8538b22e09e5c').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_9d026e2f629913f144b8538b22e09e5c').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_9d026e2f629913f144b8538b22e09e5c" href="#permalink_9d026e2f629913f144b8538b22e09e5c" class="permalink">¶</a>
		<div class="content">足し算と引き算をやって、終了コードで返す</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_fd5fcb5999be919888b9000f46c9098e').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_fd5fcb5999be919888b9000f46c9098e').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_fd5fcb5999be919888b9000f46c9098e" href="#permalink_fd5fcb5999be919888b9000f46c9098e" class="permalink">¶</a>
		<div class="content">そうそう</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_d3e635471d6c8f6ed280d6fe74eb5cd8').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_d3e635471d6c8f6ed280d6fe74eb5cd8').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_d3e635471d6c8f6ed280d6fe74eb5cd8" href="#permalink_d3e635471d6c8f6ed280d6fe74eb5cd8" class="permalink">¶</a>
		<div class="content">結局 main 関数からリターンするだけか</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_21e1e82ad5a00aff60b5f4350041dabb').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_21e1e82ad5a00aff60b5f4350041dabb').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_21e1e82ad5a00aff60b5f4350041dabb" href="#permalink_21e1e82ad5a00aff60b5f4350041dabb" class="permalink">¶</a>
		<div class="content">実はですね、今の実装は（ログに書いてありますが）_start なので、リンクせずに ebx レジスタに値をセットして、残りを OS に任せてる</div>
		<div class="content">これにより、リンクが要らない</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_51fe2ef55f6bf0a4500100a9a288de38').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_51fe2ef55f6bf0a4500100a9a288de38').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_51fe2ef55f6bf0a4500100a9a288de38" href="#permalink_51fe2ef55f6bf0a4500100a9a288de38" class="permalink">¶</a>
		<div class="content">musl と crt とリンクさせる方針じゃなくても直接吐けばいいのか</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_7e30f0026f4ce6a59d006627f49abc57').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_7e30f0026f4ce6a59d006627f49abc57').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_7e30f0026f4ce6a59d006627f49abc57" href="#permalink_7e30f0026f4ce6a59d006627f49abc57" class="permalink">¶</a>
		<div class="content">いずれは C コンパイラになることが期待されているので、いずれは関数 main や関数 foo が宣言できるようになる予定だけど、ステップ 1 を実現するのにはどう考えてもいらないので、したがって省いている</div>
		<div class="content">そう、要はなにかというと、この方法を取ることによって、まず謎解き感覚になって面白い。次に、『調べすぎちゃいけない』という縛りにしておくことで、我々ともに下手するとコンパイラにかまけて授業とか研究の手を抜きそうな民なので、それをある程度抑止できる</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_57d668909bf3b4a2ec6db14bd1e5e4c7').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_57d668909bf3b4a2ec6db14bd1e5e4c7').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_57d668909bf3b4a2ec6db14bd1e5e4c7" href="#permalink_57d668909bf3b4a2ec6db14bd1e5e4c7" class="permalink">¶</a>
		<div class="content">なるべくラクしてバイナリを吐こう、ってことか</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_19649451ea1a2ab0ec1f15b19fbeca3c').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_19649451ea1a2ab0ec1f15b19fbeca3c').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_19649451ea1a2ab0ec1f15b19fbeca3c" href="#permalink_19649451ea1a2ab0ec1f15b19fbeca3c" class="permalink">¶</a>
		<div class="content">そうそう。要は compilerbook ってかなりよく書かれた教材なので、逆に言うとあの本をそのまま再走してもあんま面白くない。私に至っては 4 年前にやったし</div>
		<div class="content">となると、こういう企画にするのが、『我々にとっての面白さ』『我々にとっての勉強になる度』『学校・趣味バランス』の 3 点において優れている、と主張します</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_155fa3a0d065d7566d704057c3341300').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_155fa3a0d065d7566d704057c3341300').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_155fa3a0d065d7566d704057c3341300" href="#permalink_155fa3a0d065d7566d704057c3341300" class="permalink">¶</a>
		<div class="content">前は gcc のコンパイル結果を比較してた？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_5eb42e8dba7c977d7a54af80a4456378').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_5eb42e8dba7c977d7a54af80a4456378').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_5eb42e8dba7c977d7a54af80a4456378" href="#permalink_5eb42e8dba7c977d7a54af80a4456378" class="permalink">¶</a>
		<div class="content">実はリポジトリに会話ログを全部取ってあって、リポジトリが <a href="https://github.com/sozysozbot/c_to_elf_compiler" target="_blank" rel="noopener noreferrer">https://github.com/sozysozbot/c_to_elf_compiler</a> 、ログが <a href="https://sozysozbot.github.io/c_to_elf_compiler/log.html" target="_blank" rel="noopener noreferrer">https://sozysozbot.github.io/c_to_elf_compiler/log.html</a> </div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_8857b292525df7826c18c6841fa7ddce').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_8857b292525df7826c18c6841fa7ddce').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_8857b292525df7826c18c6841fa7ddce" href="#permalink_8857b292525df7826c18c6841fa7ddce" class="permalink">¶</a>
		<div class="content">なんか招待来てたな</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_879027ce81c5750d693c6347341f8b3e').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_879027ce81c5750d693c6347341f8b3e').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_879027ce81c5750d693c6347341f8b3e" href="#permalink_879027ce81c5750d693c6347341f8b3e" class="permalink">¶</a>
		<div class="content">じゃあ再送しときます</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_f328a6c9737e21f70e7565974fcba948').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_f328a6c9737e21f70e7565974fcba948').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_f328a6c9737e21f70e7565974fcba948" href="#permalink_f328a6c9737e21f70e7565974fcba948" class="permalink">¶</a>
		<div class="content">受け取った気がする</div>
		<div class="content">足し算ステップってなにやるんでしたっけ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1a2399f4f6ff6bd3531fc4b78919d733').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1a2399f4f6ff6bd3531fc4b78919d733').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_1a2399f4f6ff6bd3531fc4b78919d733" href="#permalink_1a2399f4f6ff6bd3531fc4b78919d733" class="permalink">¶</a>
		<div class="content">3+5-2とかをコンパイルする</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1b4559e877b3044382348470a15fe1fc').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1b4559e877b3044382348470a15fe1fc').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_1b4559e877b3044382348470a15fe1fc" href="#permalink_1b4559e877b3044382348470a15fe1fc" class="permalink">¶</a>
		<div class="content">スタックは使わないやつだった気がする</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_4f237fbef1240b754134426c1ade0ea2').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_4f237fbef1240b754134426c1ade0ea2').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_4f237fbef1240b754134426c1ade0ea2" href="#permalink_4f237fbef1240b754134426c1ade0ea2" class="permalink">¶</a>
		<div class="content">そう</div>
		<div class="content">構成としては、最初はマジでわけが分からずバイナリをただ写経してただけだったのが、ステップを進めていくうちに『これを実装するには、自分の理解を増やすことを強いられるな……』が積み重なって、最終的にアセンブラとリンカが勝手に生えてくる</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_d0b83bc0897e55589339e1c517359752').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_d0b83bc0897e55589339e1c517359752').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_d0b83bc0897e55589339e1c517359752" href="#permalink_d0b83bc0897e55589339e1c517359752" class="permalink">¶</a>
		<div class="content">ELF の数値の表現ってどうでしたっけ。127 以下だとどうこう、だっけ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_e92b3002157bb7585a563b95f97fb2ef').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_e92b3002157bb7585a563b95f97fb2ef').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_e92b3002157bb7585a563b95f97fb2ef" href="#permalink_e92b3002157bb7585a563b95f97fb2ef" class="permalink">¶</a>
		<div class="content">最初は小さい数だけが動けばよし！</div>
		<div class="content">というのが、そもそも Rui 本のスピリット</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_e7e5b5fba690d3673304d1f5b1e906f8').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_e7e5b5fba690d3673304d1f5b1e906f8').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_e7e5b5fba690d3673304d1f5b1e906f8" href="#permalink_e7e5b5fba690d3673304d1f5b1e906f8" class="permalink">¶</a>
		<div class="content">たしかに</div>
		<div class="content">なんて名前でしたっけ、可変長の表現の名前。そうだleb128だ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_dd6521e28da7314fdccb4694b6682549').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_dd6521e28da7314fdccb4694b6682549').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_dd6521e28da7314fdccb4694b6682549" href="#permalink_dd6521e28da7314fdccb4694b6682549" class="permalink">¶</a>
		<div class="content">そういう話も、調べて、メモって、『ここ対応できるようにしたいなぁ』となったときに初めて書く、という方針になるわけですね</div>
		<div class="content">あと言うべきこととしては、とりあえずリポジトリのドキュメンテーションはそれなりには書いたので、読めば分かる</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_019733818af50ca0a38be4385b98d432').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_019733818af50ca0a38be4385b98d432').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_019733818af50ca0a38be4385b98d432" href="#permalink_019733818af50ca0a38be4385b98d432" class="permalink">¶</a>
		<div class="content">開発環境は？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_26bb1c75b943195fa18e8da39c1b681e').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_26bb1c75b943195fa18e8da39c1b681e').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_26bb1c75b943195fa18e8da39c1b681e" href="#permalink_26bb1c75b943195fa18e8da39c1b681e" class="permalink">¶</a>
		<div class="content">Ubuntu on WSL</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_e20fb0e97fd48c91f07d8d99dd8e00b6').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_e20fb0e97fd48c91f07d8d99dd8e00b6').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_e20fb0e97fd48c91f07d8d99dd8e00b6" href="#permalink_e20fb0e97fd48c91f07d8d99dd8e00b6" class="permalink">¶</a>
		<div class="content">WSL 上じゃないと開発できないようになってそう</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_f1919ce259e895fdc0a8164fa71b3cc4').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_f1919ce259e895fdc0a8164fa71b3cc4').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_f1919ce259e895fdc0a8164fa71b3cc4" href="#permalink_f1919ce259e895fdc0a8164fa71b3cc4" class="permalink">¶</a>
		<div class="content">正解のバイナリを吐くのに使ってるアセンブラ nasm が、比較的最近 --reproducible ってオプションを実装してくれたので、LTS の Ubuntu で apt で入るやつにはまだこのオプションがなく、自分で configure して make する必要がある</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_39bad6d3ab37c251fdf8536e6284ec68').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_39bad6d3ab37c251fdf8536e6284ec68').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_39bad6d3ab37c251fdf8536e6284ec68" href="#permalink_39bad6d3ab37c251fdf8536e6284ec68" class="permalink">¶</a>
		<div class="content">nasm でしたっけ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_cdc4bc05c8de5f42d2b51b572e57d1e5').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_cdc4bc05c8de5f42d2b51b572e57d1e5').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_cdc4bc05c8de5f42d2b51b572e57d1e5" href="#permalink_cdc4bc05c8de5f42d2b51b572e57d1e5" class="permalink">¶</a>
		<div class="content">実をいうと、nasm が動かなくても、nasm が生成してくれたバイナリは『コミットしてある』ので、なくても我々の c-to-elf コンパイラは走る</div>
		<div class="content">あと、ログのレンダリングは私が雑に実装したレンダラでやってて、CI のセットアップしてないので、</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_a7e837f16af289d29d8d24141ba5900c').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_a7e837f16af289d29d8d24141ba5900c').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_a7e837f16af289d29d8d24141ba5900c" href="#permalink_a7e837f16af289d29d8d24141ba5900c" class="permalink">¶</a>
		<div class="content">勝手にはされない、と</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_7db7f177fe29c6fec509435169fdc8a2').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_7db7f177fe29c6fec509435169fdc8a2').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_7db7f177fe29c6fec509435169fdc8a2" href="#permalink_7db7f177fe29c6fec509435169fdc8a2" class="permalink">¶</a>
		<div class="content">node index.js をコミット前にする必要がある</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1c47768436bc0d9c4a60bc02eed2dd4c').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1c47768436bc0d9c4a60bc02eed2dd4c').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_1c47768436bc0d9c4a60bc02eed2dd4c" href="#permalink_1c47768436bc0d9c4a60bc02eed2dd4c" class="permalink">¶</a>
		<div class="content">nasm の 2.15 だと動きます？</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_155028e5c0d93bb6cb93f92c1453a083').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_155028e5c0d93bb6cb93f92c1453a083').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_155028e5c0d93bb6cb93f92c1453a083" href="#permalink_155028e5c0d93bb6cb93f92c1453a083" class="permalink">¶</a>
		<div class="content">自信ないけど 2.16 以降が必要だったかな</div>
	</div>
</div>
<h3 class="date">2022年10月16日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_dc2876834cbd13f59b52401128da150d').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_dc2876834cbd13f59b52401128da150d').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_dc2876834cbd13f59b52401128da150d" href="#permalink_dc2876834cbd13f59b52401128da150d" class="permalink">¶</a>
		<div class="content">加減算の実装</div>
		<div class="content">&#x60;experiment/tiny3&#x60; のサイズが4kを超えていて機械語どころかアセンブリも詳しくない人には厳しい。</div>
		<div class="content">以下プログラムで127バイトのelfを生成して実行すると終了コード0を出力することを確認。<a href="https://github.com/tchajed/minimal-elf" target="_blank" rel="noopener noreferrer">https://github.com/tchajed/minimal-elf</a></div>
		<div class="content">&#x60;31 ff (xor %edi,%edi&#x60;) を &#x60;6a 01 (push $0x01) 5f (pop %edi)&#x60; にバイナリエディタで書き換えると終了コードが1になることを確認。アドレス &#x60;0x78&#x60; 以降を書き換えれば加減算の実装は簡単にできそうだ。</div>
		<div class="content">objdumpコマンドでmovやaddやsubのバイナリ表現を調べて実装終わり</div>
	</div>
</div>
<h3 class="date">2022年10月17日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_f1c2f3cca27c834a18e455680da1d6fc').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_f1c2f3cca27c834a18e455680da1d6fc').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_f1c2f3cca27c834a18e455680da1d6fc" href="#permalink_f1c2f3cca27c834a18e455680da1d6fc" class="permalink">¶</a>
		<div class="content"></div>
		<div class="content">えーと次にやるべきは……『<a href="https://www.sigbus.info/compilerbook#%E3%82%B9%E3%83%86%E3%83%83%E3%83%973%E3%83%88%E3%83%BC%E3%82%AF%E3%83%8A%E3%82%A4%E3%82%B6%E3%82%92%E5%B0%8E%E5%85%A5">ステップ3：トークナイザを導入</a>』か。すぐ終わりそう</div>
		<div class="content">check 2 &quot;5 - 3&quot; を走らせ、テストが無事落ちることを確認。</div>
		<div class="content">トークナイザをサクッと書いて、挿げ替えて、テストが通ることを確認。</div>
	</div>
</div>
<h3 class="date">2022年10月27日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_0314cf3f3f5e8aba97d25eccf9be3133').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_0314cf3f3f5e8aba97d25eccf9be3133').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_0314cf3f3f5e8aba97d25eccf9be3133" href="#permalink_0314cf3f3f5e8aba97d25eccf9be3133" class="permalink">¶</a>
		<div class="content">エラーメッセージを改善するだけ</div>
		<div class="content">エラー型を定義して関数分割して実装。分岐を少なくするためにtokenにeofを追加</div>
	</div>
</div>
<h3 class="date">2022年10月29日（一人で作業）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_cb79ec7e5c13f1a1980fe29388b12e53').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_cb79ec7e5c13f1a1980fe29388b12e53').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_cb79ec7e5c13f1a1980fe29388b12e53" href="#permalink_cb79ec7e5c13f1a1980fe29388b12e53" class="permalink">¶</a>
		<div class="content">tkr からプルリクが来ておる。コードを読んだ。なるほどね。マージ</div>
	</div>
</div>
<h3 class="date">2022年10月29日（Discord にて）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_e859820effc6566b471cfcfca220cadd').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_e859820effc6566b471cfcfca220cadd').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_e859820effc6566b471cfcfca220cadd" href="#permalink_e859820effc6566b471cfcfca220cadd" class="permalink">¶</a>
		<div class="content">とまあこういうことをやってるんですよ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/_hiromi_mi" target="_blank" rel="noopener noreferrer"><img alt="hiromi_mi" class="icon" src="icons/hiromi_mi.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_cf1df300e9c18d4fddd307a8e9b97757').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_cf1df300e9c18d4fddd307a8e9b97757').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/_hiromi_mi" target="_blank" rel="noopener noreferrer">hiromi_mi</a></span><a id="permalink_cf1df300e9c18d4fddd307a8e9b97757" href="#permalink_cf1df300e9c18d4fddd307a8e9b97757" class="permalink">¶</a>
		<div class="content">おもしろかったです、ushitora_anqouと違ってELFファイルを出力できるような状態をたもちつつ拡張するなど、アイデアに一本取られました</div>
		<div class="content">LEB128 はこれですね <a href="https://ja.osdn.net/projects/drdeamon64/wiki/LEB128%E3%81%AA%E6%95%B0%E3%81%AE%E8%A1%A8%E7%8F%BE" target="_blank" rel="noopener noreferrer">https://ja.osdn.net/projects/drdeamon64/wiki/LEB128%E3%81%AA%E6%95%B0%E3%81%AE%E8%A1%A8%E7%8F%BE</a> </div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_0bfa2d49560c30d5588d81f60e09e182').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_0bfa2d49560c30d5588d81f60e09e182').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_0bfa2d49560c30d5588d81f60e09e182" href="#permalink_0bfa2d49560c30d5588d81f60e09e182" class="permalink">¶</a>
		<div class="content">ふむふむ。わりと自然な発想のエンコーディングですね</div>
	</div>
</div>
<h3 class="date">2022年10月29日（一人で作業）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_8f33bc9708a4a396fb603b7896001e84').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_8f33bc9708a4a396fb603b7896001e84').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_8f33bc9708a4a396fb603b7896001e84" href="#permalink_8f33bc9708a4a396fb603b7896001e84" class="permalink">¶</a>
		<div class="content">さてやっていこう。compilerbook のステップ 5 には</div>
		<blockquote>説明の都合上、一気に*、/、()を実装しているような話の流れになっていますが、実際には一気に実装することは避ける方がよいでしょう。
元々、加減算ができる機能があったわけですから、まずはその機能を壊さずに、抽象構文木とそれを使ったコードジェネレータを導入するようにしてみてください。
そのときには新たな機能を足すわけではないので、新しいテストは必要ありません。その後に、*、/、()を、テスト込みで実装していってください。
</blockquote>
		<div class="content">と書いてあるので、まずは抽象構文木を導入すべきなんだな</div>
		<div class="content">まずは clippy の pedantic でも足して、</div>
		<div class="content">あとそろそろ tokenize を別ファイルに分離するか</div>
		<div class="content">apperror.rs と tokenize.rs を分離</div>
	</div>
</div>
<h3 class="date">2022年10月30日（一人で作業）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1c655b71d5d85463db69d6f591b175bb').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1c655b71d5d85463db69d6f591b175bb').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_1c655b71d5d85463db69d6f591b175bb" href="#permalink_1c655b71d5d85463db69d6f591b175bb" class="permalink">¶</a>
		<div class="content">そして抽象構文木を導入</div>
		<div class="content">さて、コードジェネレーターでこれを使わなきゃいけないんだよな</div>
	</div>
</div>
<h3 class="date">2022年10月30日（Discord にて）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_ea3cf2e058f8392a7b8eb2baaedbaab2').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_ea3cf2e058f8392a7b8eb2baaedbaab2').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_ea3cf2e058f8392a7b8eb2baaedbaab2" href="#permalink_ea3cf2e058f8392a7b8eb2baaedbaab2" class="permalink">¶</a>
		<div class="content">とまあこういうことをやっています</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/ikubaku10" target="_blank" rel="noopener noreferrer"><img alt="ikubaku" class="icon" src="icons/ikubaku.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_7c3f3ecc1b31296179b0b264dfccb0ca').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_7c3f3ecc1b31296179b0b264dfccb0ca').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/ikubaku10" target="_blank" rel="noopener noreferrer">ikubaku</a></span><a id="permalink_7c3f3ecc1b31296179b0b264dfccb0ca" href="#permalink_7c3f3ecc1b31296179b0b264dfccb0ca" class="permalink">¶</a>
		<div class="content">実行形式の中でも ELF にしてるのってどういう理由です？ELF はそれなりに複雑であり、難易度が上がる気がしていますけど</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1b1f4ef9eddfccd5f59c04bb367d3789').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1b1f4ef9eddfccd5f59c04bb367d3789').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_1b1f4ef9eddfccd5f59c04bb367d3789" href="#permalink_1b1f4ef9eddfccd5f59c04bb367d3789" class="permalink">¶</a>
		<div class="content">一番ポピュラーであり、私の WSL 環境で動くからです。あと、その複雑さを上手く回避する小技を導入しています（step 1 をどう実装したかを見せる）</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/_hiromi_mi" target="_blank" rel="noopener noreferrer"><img alt="hiromi_mi" class="icon" src="icons/hiromi_mi.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_4977d1186cc476a2c0af300da656df3b').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_4977d1186cc476a2c0af300da656df3b').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/_hiromi_mi" target="_blank" rel="noopener noreferrer">hiromi_mi</a></span><a id="permalink_4977d1186cc476a2c0af300da656df3b" href="#permalink_4977d1186cc476a2c0af300da656df3b" class="permalink">¶</a>
		<div class="content">最近の Linux では a.out フォーマットのサポートが消えたので、ELF を選択するという判断は妥当そうに思えます。Windows の com も今はダメですし</div>
	</div>
</div>
<h3 class="date">2022年10月30日（コードジェネレーター）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_3043e58678ee7f4aa7cc4eb0e01f71f0').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_3043e58678ee7f4aa7cc4eb0e01f71f0').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_3043e58678ee7f4aa7cc4eb0e01f71f0" href="#permalink_3043e58678ee7f4aa7cc4eb0e01f71f0" class="permalink">¶</a>
		<div class="content">抽象構文木を導入したことにより、許容される式の自由度が真に上がったので、コードジェネレーターを書き換えねばならない。</div>
		<div class="content">……よな？ここをちゃんと確認しないと『必要最低限のみを調べる』という縛りに抵触してしまう。</div>
		<div class="content">うむ、一方向にのみ伸びているとは限らない木を処理できるようにするには、スタックマシンの仕組みを導入しないと無理ですな</div>
		<div class="content">えーと tkr の書いたバイナリ表現を読まないとリファクタリングできない。よって調べる</div>
		<div class="content"><a href="https://defuse.ca/online-x86-assembler.htm" target="_blank" rel="noopener noreferrer">https://defuse.ca/online-x86-assembler.htm</a> に投げたところ、bf ** 00 00 00 は edi レジスタに ** をセットするらしい。じゃあ 83 c7 ** は edi を増やして 83 ef ** は edi を減らすのでしょう</div>
		<div class="content">とはいえ、我々は「なるべくアセンブリ言語について知らないようにしている」という設定なので、これに mov とか add とか名前を付けるのでは面白くない</div>
		<div class="content">せっかく Rust が識別子に日本語を許すようになったのだし、『edi増加』『edi減少』とかの関数名にしてしまえ</div>
		<div class="content">えーと、スタックマシンにする必要がある。そのためにはどのような機械語が必要だろうか。レジスタとメモリの間で色々移動させる必要がありそうだな</div>
		<div class="content">『即値をスタックにpush』『レジスタをスタックにpush』『スタックからレジスタへとpop』『レジスタの中身を、別のレジスタに足し合わせる』があればいい</div>
		<div class="content">tkr が既に「6a 01 (push $0x01)」「5f (pop %edi)」というのを調べてくれている。えーと、</div>
		<blockquote>☑ 即値をプッシュ 
☒ ediをプッシュ
☑ ediへとポップ
☒ eaxへとポップ
☒ ediにeaxを足し合わせる
☒ ediからeaxを減じる
</blockquote>
		<div class="content">ということで、あとは残り 4 つを調べればよい</div>
		<pre><code class="language-rust">fn 即値をプッシュ(n: u8) -&gt; [u8; 2] {
    [0x6a, n]
}

fn ediをプッシュ() -&gt; [u8; 1] {
    [0x57]
}

fn ediへとポップ() -&gt; [u8; 1] {
    [0x5f]
}

fn eaxへとポップ() -&gt; [u8; 1] {
    [0x58]
}

fn ediにeaxを足し合わせる() -&gt; [u8; 2] {
    [0x01, 0xc7]
}

fn ediからeaxを減じる() -&gt; [u8; 2] {
    [0x29, 0xc7]
}
</code></pre>
		<div class="content">あとはこれらを組み合わせれば動くはず。これでいいかな</div>
		<pre><code class="language-rust">fn exprを評価してediレジスタへ(writer: &amp;mut impl Write, expr: &amp;Expr) {
    match expr {
        Expr::BinaryExpr {
            op: BinaryOp::Add,
            op_pos: _,
            左辺,
            右辺,
        } =&gt; {
            exprを評価してediレジスタへ(writer, 左辺);
            writer.write_all(&amp;ediをプッシュ()).unwrap();
            exprを評価してediレジスタへ(writer, 右辺);
            writer.write_all(&amp;ediをプッシュ()).unwrap();
            writer.write_all(&amp;eaxへとポップ()).unwrap();
            writer.write_all(&amp;ediへとポップ()).unwrap();
            writer.write_all(&amp;ediにeaxを足し合わせる()).unwrap();
        }
        Expr::BinaryExpr {
            op: BinaryOp::Sub,
            op_pos: _,
            左辺,
            右辺,
        } =&gt; {
            exprを評価してediレジスタへ(writer, 左辺);
            writer.write_all(&amp;ediをプッシュ()).unwrap();
            exprを評価してediレジスタへ(writer, 右辺);
            writer.write_all(&amp;ediをプッシュ()).unwrap();
            writer.write_all(&amp;eaxへとポップ()).unwrap();
            writer.write_all(&amp;ediへとポップ()).unwrap();
            writer.write_all(&amp;ediからeaxを減じる()).unwrap();
        }
        Expr::Primary { val, pos: _ } =&gt; {
            writer.write_all(&amp;ediに代入(*val)).unwrap();
        }
    }
}

fn parse_and_codegen(
    mut writer: &amp;mut impl Write,
    tokens: &amp;[Token],
    input: &amp;str,
) -&gt; Result&lt;(), AppError&gt; {
    let expr = parse(tokens, input)?;

    let tiny = include_bytes!(&quot;../experiment/tiny&quot;);
    writer.write_all(&amp;tiny[0..0x78]).unwrap();
    writer.write_all(&amp;[0xb8, 0x3c, 0x00, 0x00, 0x00]).unwrap();

    exprを評価してediレジスタへ(&amp;mut writer, &amp;expr);

    writer.write_all(&amp;[0x0f, 0x05]).unwrap();
    Ok(())
}
</code></pre>
		<div class="content">走らせてみよう</div>
		<pre><code class="language-">[FAIL] 1+2 =&gt; 3 expected, but got 139
</code></pre>
		<div class="content">なるほど落ちる。あー、多分 eax レジスタをなんか別ので使ってるんだろうな。0xb8, 0x3c, 0x00, 0x00, 0x00 辺りかな</div>
		<div class="content">じゃあそれを『exprを評価してediレジスタへ』より後ろに回すと……動いた。</div>
	</div>
</div>
<h3 class="date">2022年10月30日（乗算）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1b28c8027b05825cacf886323884e99a').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1b28c8027b05825cacf886323884e99a').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_1b28c8027b05825cacf886323884e99a" href="#permalink_1b28c8027b05825cacf886323884e99a" class="permalink">¶</a>
		<div class="content">次は乗算を組んでいこう。まず構文木に BinaryOp::Mul を加える。対応するバイナリ表現も調べる</div>
		<pre><code class="language-rust">fn ediをeax倍にする() -&gt; [u8; 3] {
    [0x0f, 0xaf, 0xf8]
}
</code></pre>
		<div class="content">次に、再帰下降パーサにする。前に自分で書いた Rust での再帰下降を眺めよう</div>
		<div class="content"><a href="https://docs.google.com/presentation/d/180pyDEMnBUPVIsQuNYgbdD0oWB-vZdzoJR4md_yEYRQ/edit#slide=id.g1339727b6e0_0_237" target="_blank" rel="noopener noreferrer">https://docs.google.com/presentation/d/180pyDEMnBUPVIsQuNYgbdD0oWB-vZdzoJR4md_yEYRQ/edit#slide=id.g1339727b6e0_0_237</a></div>
		<div class="content">再帰下降パーサというのは、『読めるところまで読み、それ以外は読み残す』という挙動をする部品を組み合わせることで上手くいく</div>
		<div class="content">ということで、とりあえずイテレータを取るような関数へと変更。peekable もほしいかな</div>
		<div class="content">そして parse_multiplicative 関数を実装し、parse の中ではそれを呼ぶようにする</div>
		<div class="content">さて 3*4-5 が動くかな？おっと Mac ではそもそもどのテストケースも通らない。WSL で試すか</div>
		<div class="content">ああ普通に 1+2 が落ちてる。それはそうで、せっかく peekable にしたのに peek していない</div>
		<div class="content">peekするようにすると……おっと『演算子かeofが期待されていますが、数か * が来ました』と言われる。ああここも peek にしないとね。あと第一式も parse_multiplicative にしないと</div>
		<div class="content">修正したら通った。&quot;9 *8  - 7*  6 + 5*  4*1&quot; とかも通りますね</div>
		<div class="content">次はカッコを実装しよう。そのためには、</div>
		<div class="content"><ul><li>数値リテラルを読むところを parse_primary 関数に切り出す</li><li>『全部読めていない場合に落とす』の部分を parse 関数から切り出す</li><li>カッコで括った式を primary と見なす</li></ul></div>
		<div class="content">という変更を加えることになる。とりあえず最初の二つをやり、テストが通ることを確認</div>
		<div class="content">次はトークナイザへのカッコの追加だ。正直 paren, sqbracket, brace とかより『開き丸括弧』の方が読みやすくない？バンバン日本語識別子を使っていこう</div>
		<div class="content">そうしたら parse_primary の中で parse_additive を呼んでやって、テストを書く</div>
		<div class="content">えーと &quot;5*(6-3)*7&quot; が「演算子の次に来ているものが数値ではありません」で落ちる</div>
		<div class="content">ああ、parse_multicative の右辺の方を parse_primary にしていなかったな。直した。テストが通る</div>
		<div class="content">残るは除算の実装だけ。これ面倒なんだよな。compilerbook にはこう書いてある</div>
		<blockquote>特にパースやコード生成において重要なポイントではないのですが、トリッキーな仕様のidiv命令が上のコードでは使われているので、それについて説明しておきましょう。

idivは符号あり除算を行う命令です。x86-64のidivが素直な仕様になっていれば、上のコードでは本来idiv rax, rdiのように書きたかったところですが、そのような2つのレジスタをとる除算命令はx86-64には存在しません。その代わりに、idivは暗黙のうちにRDXとRAXを取って、それを合わせたものを128ビット整数とみなして、それを引数のレジスタの64ビットの値で割り、商をRAXに、余りをRDXにセットする、という仕様になっています。cqo命令を使うと、RAXに入っている64ビットの値を128ビットに伸ばしてRDXとRAXにセットすることができるので、上記のコードではidivを呼ぶ前にcqoを呼んでいます。
</blockquote>
		<div class="content">ということで、足すべきは以下の通り</div>
		<pre><code class="language-rust">fn eaxの符号ビットをedxへ拡張() -&gt; [u8; 1] {
    [0x99]
}

fn edx_eaxをediで割る_商はeaxに_余りはedxに() -&gt; [u8; 2] {
    [0xf7, 0xff]
}

fn eaxをプッシュ() -&gt; [u8; 1] {
    [0x50]
}
</code></pre>
		<div class="content">テストケースも足したし、これで『ステップ5：四則演算のできる言語の作成』が完了</div>
	</div>
</div>
<h3 class="date">2022年10月31日（Discordにて）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_ca831b8a56a7c365a365176b1a395618').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_ca831b8a56a7c365a365176b1a395618').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_ca831b8a56a7c365a365176b1a395618" href="#permalink_ca831b8a56a7c365a365176b1a395618" class="permalink">¶</a>
		<div class="content">コードレビューお願いします</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_fadde74faef94ad4b48c034a1156818b').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_fadde74faef94ad4b48c034a1156818b').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_fadde74faef94ad4b48c034a1156818b" href="#permalink_fadde74faef94ad4b48c034a1156818b" class="permalink">¶</a>
		<div class="content">diff がでかくて見るのが大変で放置してた</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_3ae073460abb79cdc6419b3f5e23433c').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_3ae073460abb79cdc6419b3f5e23433c').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_3ae073460abb79cdc6419b3f5e23433c" href="#permalink_3ae073460abb79cdc6419b3f5e23433c" class="permalink">¶</a>
		<div class="content">まあ再帰下降にする過程で全部書き直す羽目になりますからねぇ</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_254d1ad01548c243fe4c97615b7e2486').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_254d1ad01548c243fe4c97615b7e2486').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_254d1ad01548c243fe4c97615b7e2486" href="#permalink_254d1ad01548c243fe4c97615b7e2486" class="permalink">¶</a>
		<div class="content">わかるなぁ</div>
		<div class="content">そういえば、ログのページを生成するのも CI にしたい。えーと今は master ブランチの上の GitHub Pages を直に公開してるのか</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_3cd63bac44e2773ac5eba6c3a59aec4d').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_3cd63bac44e2773ac5eba6c3a59aec4d').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_3cd63bac44e2773ac5eba6c3a59aec4d" href="#permalink_3cd63bac44e2773ac5eba6c3a59aec4d" class="permalink">¶</a>
		<div class="content">じゃあ step 8 の代わりに CI の整備とかお願いしていいですかね。本来の step 8 はコンパイラのソースコードをファイル分割して Makefile をセットアップするプロセスなんですけど、Rust で書いている我々にとっては既にそれは解決されているので</div>
	</div>
</div>
<h3 class="date">2022年10月31日（GitHubにて）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_eb926e9e0618b979e705a25a46220017').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_eb926e9e0618b979e705a25a46220017').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_eb926e9e0618b979e705a25a46220017" href="#permalink_eb926e9e0618b979e705a25a46220017" class="permalink">¶</a>
		<div class="content">これposどこにするか迷う 🤔</div>
		<div class="content">エラーメッセージ的にはここが正しそうだけど「unexpected token」的なエラーメッセージとどっちが分かりやすいんだろう</div>
		<pre><code class="language-rust">                _ =&gt; Err(AppError {
                    message: &quot;この開き丸括弧に対応する閉じ丸括弧がありません&quot;.to_string(),
                    input: input.to_string(),
                    pos: *pos,
</code></pre>
		<div class="content">というのが気になったけど、大体よさそう</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_623da2754d9a13aa2e732b9dc394497b').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_623da2754d9a13aa2e732b9dc394497b').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_623da2754d9a13aa2e732b9dc394497b" href="#permalink_623da2754d9a13aa2e732b9dc394497b" class="permalink">¶</a>
		<div class="content">まあ理想的には Rust みたいに「範囲」でエラーを持つ方がきれいですよね。まあ Rui 本はあんまりエラーに凝らない設計なので、あんま深く考えなくていいでしょう</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_440e5c364874e021496b2b407cacaeed').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_440e5c364874e021496b2b407cacaeed').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_440e5c364874e021496b2b407cacaeed" href="#permalink_440e5c364874e021496b2b407cacaeed" class="permalink">¶</a>
		<div class="content">あとは Peekable 使うかスライス使うかとか迷うなぁ</div>
		<div class="content">パーサのファイル分割とかはstep8？でやるかー</div>
	</div>
</div>
<h3 class="date">2022年11月7日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_83d515068a98112f517a67f012288f3d').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_83d515068a98112f517a67f012288f3d').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_83d515068a98112f517a67f012288f3d" href="#permalink_83d515068a98112f517a67f012288f3d" class="permalink">¶</a>
		<div class="content">そろそろやらなければ</div>
		<div class="content">単項演算子の実装はパーサー少し変更するだけっぽいので一瞬で終わった</div>
		<div class="content">色々テスト書いて終わり</div>
		<div class="content">今後 &#x60;-&quot;x&quot;&#x60; みたいな型エラー発生するコードを書いたときにエラーメッセージが微妙に分かりにくくなるのが気になるが</div>
	</div>
</div>
<h3 class="date">2022年11月9日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_e03f7074bd5561684ee5a00d3b3d9580').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_e03f7074bd5561684ee5a00d3b3d9580').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_e03f7074bd5561684ee5a00d3b3d9580" href="#permalink_e03f7074bd5561684ee5a00d3b3d9580" class="permalink">¶</a>
		<div class="content">やるぞ</div>
		<div class="content">比較演算子を実装。ここら辺は本当にやるだけだな</div>
		<div class="content">関数が長くなりすぎて clippy が文句を言ってきているな。でもこれ過剰に分割しても読みやすくならないだろうし、#[allow(clippy::too_many_lines)] でお茶を濁そう</div>
	</div>
</div>
<h3 class="date">2022年11月10日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_851228c2ce77ea9f2b04f90377355ba2').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_851228c2ce77ea9f2b04f90377355ba2').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_851228c2ce77ea9f2b04f90377355ba2" href="#permalink_851228c2ce77ea9f2b04f90377355ba2" class="permalink">¶</a>
		<div class="content">CIの整備をします</div>
		<div class="content">github pagesの設定を修正してactionsからのアップロードみたいなのに変更する必要があるけど権限ないのでお願いします</div>
		<div class="content">やったことはコミットメッセージに</div>
	</div>
</div>
<h3 class="date">2022年11月11日（CIの修正）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1191af1a99124606724e61679c923bb2').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1191af1a99124606724e61679c923bb2').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_1191af1a99124606724e61679c923bb2" href="#permalink_1191af1a99124606724e61679c923bb2" class="permalink">¶</a>
		<div class="content">tkr からプルリクが来ておるな</div>
		<div class="content">CIの整備と、ファイル分割がされている。ありがたい。まずマージして、</div>
		<div class="content">設定を変更して、えっと</div>
		<div class="content">あーあれか、マージしてから設定を変更したせいで、この版まではデフォルトのgithub-pages アクションに基づいて生成されているのか</div>
		<div class="content">じゃあ、もう一回コミットしたら tkr の書いた GitHub Action が走ってくれる？</div>
		<div class="content">んー、Workflow details will appear here once your site has been deployed. と言われる</div>
		<div class="content">Your site was last deployed to the github-pages environment by the pages build and deployment workflow. とのことだから、設定できてないな</div>
		<div class="content"><a href="https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site" target="_blank" rel="noopener noreferrer">https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site</a> 曰く、</div>
		<blockquote>If you already have a workflow to publish your site, you can skip this step. 

GitHub Pages does not associate a specific workflow to the GitHub Pages settings. However, the GitHub Pages settings will link to the workflow run that most recently deployed your site.
</blockquote>
		<div class="content">とのこと。つまり、Source: GitHub Actions とだけ出てそれ以上設定する画面がないという現状で問題ないっぽい</div>
		<div class="content">次に、<a href="https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site#creating-a-custom-github-actions-workflow-to-publish-your-site" target="_blank" rel="noopener noreferrer">https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site#creating-a-custom-github-actions-workflow-to-publish-your-site</a> を見ると、</div>
		<blockquote>The general flow of a workflow is to:

1. Trigger whenever there is a push to the default branch of the repository or whenever the workflow is run manually from the Actions tab.

2. Use the actions/checkout action to check out the repository contents.
    
3. If required by your site, build any static site files.

4. Use the actions/upload-pages-artifact action to upload the static files as an artifact.
    
5. If the workflow was triggered by a push to the default branch, use the actions/deploy-pages action to deploy the artifact. This step is skipped if the workflow was triggered by a pull request.
</blockquote>
		<div class="content">と書いてある。tkr の書いてくれた workflows/docs.yaml には actions/checkout と actions/upload-pages-artifact が言及されている</div>
		<div class="content">ふむ、The starter workflows use a deployment environment called github-pages. If your repository does not already include an environment called github-pages, the environment will be created automatically. と書いてある。名前を変えてみるか</div>
		<div class="content">うまくいかない。 actions/deploy-pages action を足してみるか</div>
		<div class="content">CI が落ちた。<a href="https://github.com/sozysozbot/c_to_elf_compiler/actions/runs/3438529083/jobs/5734705044" target="_blank" rel="noopener noreferrer">https://github.com/sozysozbot/c_to_elf_compiler/actions/runs/3438529083/jobs/5734705044</a> </div>
		<blockquote>Error: Error message: Unable to get ACTIONS_ID_TOKEN_REQUEST_URL env variable
    at Function.&lt;anonymous&gt; (/home/runner/work/_actions/actions/deploy-pages/v1/webpack:/deploy-pages/node_modules/@actions/core/lib/oidc-utils.js:71:1)
    at Generator.next (&lt;anonymous&gt;)
    at /home/runner/work/_actions/actions/deploy-pages/v1/webpack:/deploy-pages/node_modules/@actions/core/lib/oidc-utils.js:8:1
    at new Promise (&lt;anonymous&gt;)
    at __webpack_modules__.8041.__awaiter (/home/runner/work/_actions/actions/deploy-pages/v1/webpack:/deploy-pages/node_modules/@actions/core/lib/oidc-utils.js:4:1)
    at Function.getIDToken (/home/runner/work/_actions/actions/deploy-pages/v1/webpack:/deploy-pages/node_modules/@actions/core/lib/oidc-utils.js:57:1)
    at Object.&lt;anonymous&gt; (/home/runner/work/_actions/actions/deploy-pages/v1/webpack:/deploy-pages/node_modules/@actions/core/lib/core.js:315:1)
    at Generator.next (&lt;anonymous&gt;)
    at /home/runner/work/_actions/actions/deploy-pages/v1/webpack:/deploy-pages/node_modules/@actions/core/lib/core.js:27:1
    at new Promise (&lt;anonymous&gt;)
Error: Ensure GITHUB_TOKEN has permission &quot;idToken: write&quot;.
</blockquote>
		<div class="content">うーむ。とりあえず上手くいっていないので、せっかくバージョン管理されていることだし、上手くいっていたところまで強引に世界を差し戻すか？</div>
		<div class="content">いや、<a href="https://github.com/jurliyuuri/cerke_online_alpha/blob/master/.github/workflows/deploy.yml" target="_blank" rel="noopener noreferrer">https://github.com/jurliyuuri/cerke_online_alpha/blob/master/.github/workflows/deploy.yml</a> のを転用して、gh-pages ブランチからページを生やすようにしよう</div>
		<div class="content">えーと、<a href="https://github.com/sozysozbot/c_to_elf_compiler/actions/runs/3438695080/workflow" target="_blank" rel="noopener noreferrer">https://github.com/sozysozbot/c_to_elf_compiler/actions/runs/3438695080/workflow</a> 曰く、</div>
		<blockquote>The workflow is not valid. .github/workflows/docs.yaml (Line: 35, Col: 14): Unexpected value &#x27;&#x27; .github/workflows/docs.yaml (Line: 36, Col: 9): Unexpected value &#x27;github_token&#x27;
</blockquote>
		<div class="content">それはそう。え、でも cerke_online_alpha には secret が設定されていないと書いてあるけど</div>
		<div class="content"><a href="https://github.com/peaceiris/actions-gh-pages" target="_blank" rel="noopener noreferrer">https://github.com/peaceiris/actions-gh-pages</a> 曰く、</div>
		<blockquote>For newbies of GitHub Actions: Note that the GITHUB_TOKEN is NOT a personal access token. A GitHub Actions runner automatically creates a GITHUB_TOKEN secret to authenticate in your workflow. So, you can start to deploy immediately without any configuration.
</blockquote>
		<div class="content">あ、そうなの。じゃあなんで落ちてるんだろうか</div>
		<div class="content"><a href="https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-first-deployment-with-github_token" target="_blank" rel="noopener noreferrer">https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-first-deployment-with-github_token</a> を読む。なるほど、初回は失敗することが想定されているのか。へー</div>
		<div class="content">とりあえず git checkout --orphan gh-pages をして push することで gh-pages ブランチを作るか</div>
		<div class="content">えーとインデントが壊れている。直そう</div>
		<div class="content">ジョブは走っているが、ページが出力されない。.nojekyll ってファイルだけが生えておる</div>
		<div class="content">ああ、publish_dir がミスってるのか</div>
		<div class="content">直したら直った！URL も今までと変わらず提供できている。勝利ですね。リポジトリの README も直しておくか</div>
	</div>
</div>
<h3 class="date">2022年11月11日（一文字変数）</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_874905eba43503712b5fd73718fe67dc').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_874905eba43503712b5fd73718fe67dc').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_874905eba43503712b5fd73718fe67dc" href="#permalink_874905eba43503712b5fd73718fe67dc" class="permalink">¶</a>
		<div class="content">さて、次は複文と一文字変数</div>
		<div class="content">そういえば、compilerbook では『一番最後の式の結果をプログラム全体の計算結果とすることにします』として、構文定義がこうなってるけど、</div>
		<blockquote>program    = stmt*
stmt       = expr &quot;;&quot;
expr       = assign
assign     = equality (&quot;=&quot; assign)?
equality   = relational (&quot;==&quot; relational | &quot;!=&quot; relational)*
relational = add (&quot;&lt;&quot; add | &quot;&lt;=&quot; add | &quot;&gt;&quot; add | &quot;&gt;=&quot; add)*
add        = mul (&quot;+&quot; mul | &quot;-&quot; mul)*
mul        = unary (&quot;*&quot; unary | &quot;/&quot; unary)*
unary      = (&quot;+&quot; | &quot;-&quot;)? primary
primary    = num | ident | &quot;(&quot; expr &quot;)&quot;
</blockquote>
		<div class="content">このプロジェクトは Rust で書いてるんだし、Rust と同様に『文の列の最後に式を書くと、それが戻り値になる』で組もうかな</div>
		<div class="content">こうすることの利点としては、</div>
		<div class="content"><ul><li>今までのテストケースに手を入れなくて済む</li><li>スタック操作をミスってバグが出たときに、より早期に気づきやすい（Cコンパイラ班の受講生で、ここの周りで混乱してバグらせた人を見た）</li><li>実はセミコロンを中置演算子として見ることができ、既存の再帰下降のコピペで実装が終わる</li></ul></div>
		<div class="content">などが挙げられそう</div>
		<div class="content">ところで、関係ないけど、このログを生成する自作ツール PseudoRoku に箇条書き機能欲しくなってきたな。$HTML コマンドに &lt;ul&gt; を食わせて1行ずつで書かなきゃいけないのが面倒になってきた</div>
		<div class="content">さて、とりあえずトークナイザに一文字変数を足さねば。あと Assign 演算子も足そう。右結合だから、ループにせずとも再帰で十分</div>
		<div class="content">いや、まずは最小限の変更で動かしたいから、最初はセミコロンだけだな。AndThenという二項演算子として処理して、</div>
		<pre><code class="language-rust">        Expr::BinaryExpr {
            op: BinaryOp::AndThen,
            op_pos: _,
            左辺,
            右辺,
        } =&gt; {
            exprを評価してediレジスタへ(writer, 左辺); // 左辺は push せずに捨てる
            exprを評価してediレジスタへ(writer, 右辺);
        }
</code></pre>
		<div class="content">これだけで動くはず。便利</div>
		<div class="content">次に、一文字変数と代入が必要。&#x27;a&#x27; から &#x27;z&#x27; および &#x27;=&#x27; をトークナイズし、パーサーを増やす。parse_primary で識別子を読むコードも必要</div>
		<div class="content">あとはコード生成を書くだけ。今回の実装では return しないので、エピローグは不要で、プロローグで変数 26 個分の領域を確保すれば十分</div>
		<div class="content">おや、パースが通らない。なるほど、再帰下降のコピペミスか。直した。しかし Mac だとテストケースごとに docker run するから遅いな。しょうがないけど</div>
		<div class="content">直したらパースが通るようになったが、&#x60;a = 3; b = 4; a + b&#x60; で &#x60;7 expected, but got 139&#x60; が出ている。なんかミスっておるな</div>
		<div class="content">&#x60;a = 7; a&#x60; でも同じ。ところで、この手のミスをすると毎回 139 が来る気がするけど、これなんなんだろう</div>
		<div class="content">あーわかった。コメントアウトしてた『ediから即値を引く』関数をそのまま使ってたけど、これは『edi から即値を引く』から、rdi の上位 32 ビットがクリアされちゃってるんだな</div>
		<div class="content">ということで、</div>
		<pre><code class="language-rust">fn rdiから即値を引く(n: u8) -&gt; [u8; 4] {
    [0x48, 0x83, 0xef, n]
}
</code></pre>
		<div class="content">にしたら……動いた！</div>
		<div class="content">今までは意図的に 32 ビットレジスタと 64 ビットレジスタを混同するような書き方をしてきたけど、そろそろちゃんと分ける必要が出てきますわね</div>
		<div class="content">あ、CI で cargo fmt が要求されてる。掛けておくか</div>
		<div class="content">そういえば、せっかく &#x60;a = b = 7&#x60; みたいなやつに対応してあるんだから、テストケースに足しておこう</div>
	</div>
</div>
<h3 class="date">2022年11月21日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_7a3da0f0db1edd3974e41bdb1909e8b4').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_7a3da0f0db1edd3974e41bdb1909e8b4').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_7a3da0f0db1edd3974e41bdb1909e8b4" href="#permalink_7a3da0f0db1edd3974e41bdb1909e8b4" class="permalink">¶</a>
		<div class="content">そういやこの 139 ってなんなんですかね。SIGSEGV のシグナル自体は 139 ではなかった気がするんですけど</div>
		<div class="content">あー、シグナルが 11 で exit code が 139 か</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/_hiromi_mi" target="_blank" rel="noopener noreferrer"><img alt="hiromi_mi" class="icon" src="icons/hiromi_mi.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_7be1a50a776247fcbc68f5ec6317c574').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_7be1a50a776247fcbc68f5ec6317c574').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/_hiromi_mi" target="_blank" rel="noopener noreferrer">hiromi_mi</a></span><a id="permalink_7be1a50a776247fcbc68f5ec6317c574" href="#permalink_7be1a50a776247fcbc68f5ec6317c574" class="permalink">¶</a>
		<div class="content">『なんらかの異常値である』必要はそりゃあると思いますけど、具体的になんで 139 なんですかね</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_7bef5bd2a3692070fa6b5ea724c7de8a').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_7bef5bd2a3692070fa6b5ea724c7de8a').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_7bef5bd2a3692070fa6b5ea724c7de8a" href="#permalink_7bef5bd2a3692070fa6b5ea724c7de8a" class="permalink">¶</a>
		<div class="content">あ、128 + 11 ってことなのかな</div>
	</div>
</div>
<h3 class="date">2022年11月24日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_eff0c80e74d6e2ed5114532412a45ef8').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_eff0c80e74d6e2ed5114532412a45ef8').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_eff0c80e74d6e2ed5114532412a45ef8" href="#permalink_eff0c80e74d6e2ed5114532412a45ef8" class="permalink">¶</a>
		<div class="content">複数文字のローカル変数</div>
		<div class="content">Rustなので &#x60;HashMap&#x60; 使ってまあ適当に</div>
		<div class="content">変数にアンダースコアとか数値も使えるように</div>
		<div class="content">ローカル変数情報のバケツリレーつらいからそろそろcodegenをstructにしてもいいかもな</div>
		<div class="content">compilerbookだとこのステップ終わっても26個しか変数使えなくない？この制限解除しようとすると &#x60;rspから即値を引く&#x60; の段階では変数の数決まらないからきついな。とりあえず &#x60;Write + Seek&#x60; にするか</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_0989c89f653118769f1d4cbd4eacbe70').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_0989c89f653118769f1d4cbd4eacbe70').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_0989c89f653118769f1d4cbd4eacbe70" href="#permalink_0989c89f653118769f1d4cbd4eacbe70" class="permalink">¶</a>
		<div class="content">tkr からのプルリクを読みます</div>
		<div class="content">読んだ。マージした。</div>
		<div class="content">さて、今回は return 文なわけで、これによって既存のテストケースを変更する必要がある</div>
		<pre><code class="language-diff">-   a = b = 7; a 
+   a = b = 7; return a;
</code></pre>
		<div class="content">みたいな変更を全部に入れる必要があり、とりあえずそれのコンパイルを通す必要がある</div>
		<div class="content">まあ、とりあえずは return キーワードをトークナイザに足すところからですな</div>
		<div class="content">一瞬で足せた。payload をすり替えるだけだな。で、次にパーサーに手を加える必要がある。今まではセミコロンを 2 項演算子として扱っていたので、それを修正する必要がある</div>
		<div class="content">まず、Expr と Program を分離していく。定義を複製してすり替えることで、とりあえず動くものを作る</div>
		<div class="content">次に、Statement 型を立てていく。parse_statement を立て、それの繰り返しにより parse_program を定義する。Program は Vec&lt;Statement&gt; とする</div>
		<div class="content">えーっと、今回は return してるわけじゃないんだよな。とはいえ syscall したら帰ってこないから、普通にエピローグを出力すればいいのか</div>
		<div class="content">これはテストケースにもう return を足して、return 文も実装してしまおう</div>
		<div class="content">えーと通らない。『数値リテラルでも開き丸括弧でもないものが来ました』というメッセージ。多分再帰下降のどこかで「エラーを出さずにスルー」を忘れている</div>
		<div class="content">いや違うな。eof トークンがあるから while tokens.peek().is_some() ではダメなんだ。</div>
		<div class="content">直したら動いた</div>
		<div class="content">よしプルリクエストを作成。あ、テストケースを増やした方がいいな</div>
	</div>
</div>
<h3 class="date">2022年12月3日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_f88cdba870ca7e94245dcc780e85f92c').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_f88cdba870ca7e94245dcc780e85f92c').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_f88cdba870ca7e94245dcc780e85f92c" href="#permalink_f88cdba870ca7e94245dcc780e85f92c" class="permalink">¶</a>
		<div class="content">とりあえずトークナイザ実装</div>
		<div class="content">jmp/jeのバイナリ表現を調べたら0xEB バイト数/0x74 バイト数であることが分かった。前方ジャンプは負の数かつジャンプ命令自体のサイズを含むので-2となることに注意。</div>
	</div>
</div>
<h3 class="date">2022年12月4日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_1773a208b83b6508a36fcd13aba1c908').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_1773a208b83b6508a36fcd13aba1c908').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_1773a208b83b6508a36fcd13aba1c908" href="#permalink_1773a208b83b6508a36fcd13aba1c908" class="permalink">¶</a>
		<div class="content">コード生成のインターフェイスをもう少し整備したい。jmp命令という中間の命令列のバイト数情報が必要なコードの生成を考えるとWrite + Seekを持ち回すのは限界を感じる。RopeっぽいBufを実装する</div>
		<div class="content">parser実装。forの初期化部はint i = 0のような変数定義が許されるので厳密には式ではないけど今の仕様だと定義なしで代入すると変数が作られる仕様なのでとりあえず式でいいか</div>
		<div class="content">前回書いたSeekを使う汚いコードをBufを使って書き直した</div>
	</div>
</div>
<h3 class="date">2022年12月5日</h3>
<div class="one_person">
	<div><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer"><img alt="tkr" class="icon" src="icons/tkr.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_bc52690208a2b75d371d584c28abaea5').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_bc52690208a2b75d371d584c28abaea5').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/kgtkr" target="_blank" rel="noopener noreferrer">tkr</a></span><a id="permalink_bc52690208a2b75d371d584c28abaea5" href="#permalink_bc52690208a2b75d371d584c28abaea5" class="permalink">¶</a>
		<div class="content">ifとwhileのコード生成は前回の調査結果から実装。forはwhileのsyntax sugarとして実装</div>
	</div>
</div>
<div class="one_person">
	<div><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer"><img alt="hsjoihs" class="icon" src="icons/hsjoihs.webp" height="48px"></a></div>
	<div class="name_and_content" onmouseover="document.getElementById('permalink_3abc7cb49d60a3a3cc685b049f168fea').style.visibility = 'visible'" onmouseout="document.getElementById('permalink_3abc7cb49d60a3a3cc685b049f168fea').style.visibility = 'hidden'">
		<span class="name"><a href="https://twitter.com/hsjoihs" target="_blank" rel="noopener noreferrer">hsjoihs</a></span><a id="permalink_3abc7cb49d60a3a3cc685b049f168fea" href="#permalink_3abc7cb49d60a3a3cc685b049f168fea" class="permalink">¶</a>
		<div class="content">見ていくか</div>
		<div class="content">statement が statment になってる誤字があるのと、そもそも関数「statementを評価してediレジスタへ」って値を「ediレジスタへ」確実に書いてくれるんでしたっけ？</div>
		<div class="content"><ul><li>まずediレジスタへ確実に書いてくれるかわからん</li><li>書いてくれていたとしても、「edi レジスタに書きこんでいる」を前提としたコードは文のレベルでは不存在っぽそう？</li></ul></div>
		<div class="content">ということで、関数名だけ変更してマージしておきますね</div>
	</div>
</div>

<div style="font-size: 70%; display: flex; justify-content: center;">
	<div>
		Powered by <a href="https://github.com/sozysozbot/PseudoRoku">PseudoRoku</a>, which is designed by <a href="https://twitter.com/hsjoihs">hsjoihs</a>. <a href="https://github.com/sozysozbot/PseudoRoku/issues">Feel free to report any issues</a>.
	</div>
</div></body>
